<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Structura Web</title>
<style>
body { font-family: Arial, sans-serif; background: #1e1e1e; color: #ddd; padding: 20px; }
h1 { text-align: center; margin-bottom: 20px; }
textarea { width: 100%; height: 200px; background: #2e2e2e; color: #ddd; border: none; padding: 10px; font-family: monospace; margin-bottom: 10px; resize: vertical; }
ul { list-style-type: none; padding-left: 20px; }
li { cursor: pointer; padding: 2px 0; user-select: none; }
.folder::before { content: "üìÅ "; }
.hidden { display: none; }
button { padding: 10px 15px; margin: 5px 5px 15px 0; background: #444; color: #ddd; border: none; cursor: pointer; border-radius: 5px; }
button:hover { background: #555; }
#tree { margin-top: 10px; }
@media (max-width: 600px) {
    textarea { height: 150px; }
    button { width: 100%; margin-bottom: 10px; }
}
</style>
</head>
<body>

<h1>Structura Web</h1>
<textarea id="input" placeholder="Enter folder structure here using [ ] for main folders and -> for subfolders"></textarea><br>
<button onclick="generateTree()">Generate Tree</button>
<button onclick="createStructure()">Create & Download .struct</button>
<div id="tree"></div>

<script>
function parseStructura(input) {
    const lines = input.split('\n').filter(line => line.trim() !== '');
    const root = [];
    const stack = [{level: 0, children: root}];

    lines.forEach(line => {
        const trimmed = line.trim();
        let level = 0;
        let name = '';

        // Main folder
        if (trimmed.startsWith('[') && trimmed.endsWith(']')) {
            name = trimmed.slice(1, -1).trim();
            level = 0;
        } 
        // Subfolder
        else if (trimmed.startsWith('->')) {
            const arrowMatch = trimmed.match(/^(->)+/);
            level = arrowMatch[0].length;
            name = trimmed.slice(level).trim();
        } 
        else return;

        const node = { name, children: [] };

        while (stack.length && stack[stack.length - 1].level >= level) stack.pop();

        stack[stack.length - 1].children.push(node);
        stack.push({level, children: node.children});
    });

    return root;
}

function buildTreeHTML(nodes) {
    if (!nodes || nodes.length === 0) return null;
    const ul = document.createElement('ul');
    nodes.forEach(node => {
        const li = document.createElement('li');
        li.textContent = node.name;
        li.classList.add('folder');
        li.onclick = (e) => {
            e.stopPropagation();
            const childUl = li.querySelector('ul');
            if (childUl) childUl.classList.toggle('hidden');
        };
        const childrenHTML = buildTreeHTML(node.children);
        if (childrenHTML) li.appendChild(childrenHTML);
        ul.appendChild(li);
    });
    return ul;
}

function generateTree() {
    const input = document.getElementById('input').value;
    const structure = parseStructura(input);
    const treeContainer = document.getElementById('tree');
    treeContainer.innerHTML = '';
    const treeHTML = buildTreeHTML(structure);
    if (treeHTML) treeContainer.appendChild(treeHTML);
}

// Create & download as .struct
function createStructure() {
    const input = document.getElementById('input').value;
    const structure = parseStructura(input);
    const dataStr = "data:text/json;charset=utf-8," + encodeURIComponent(JSON.stringify(structure, null, 2));
    const dlAnchor = document.createElement('a');
    dlAnchor.setAttribute("href", dataStr);
    dlAnchor.setAttribute("download", "folder-structure.struct");
    document.body.appendChild(dlAnchor);
    dlAnchor.click();
    dlAnchor.remove();
    alert("Folder structure .struct file created!");
}
</script>

</body>
</html>